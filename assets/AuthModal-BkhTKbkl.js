import{g as E,d as w,r,j as e,A as N,m,L as S}from"./index-BnZUvvZr.js";import{u as k,a as A}from"./default-product-BqztsPpi.js";import{v as D,a as L,b as q}from"./validators-ByLOnyUC.js";var P=w();const U=E(P);function M({onClose:t=()=>{},isOpen:u}){const[s,p]=r.useState("login"),[d,y]=r.useState(""),[n,v]=r.useState(""),[l,f]=r.useState(""),[h,g]=r.useState(!1),{registerUser:j,loginUser:b}=k(),{addToast:i}=A();r.useEffect(()=>{if(!u)return;const a=c=>c.key==="Escape"&&t();return document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[u,t]);const _=async a=>{if(a.preventDefault(),s==="register"){const o=D(d);if(o){i(o,"error");return}}const c=L(n);if(c){i(c,"error");return}const x=q(l);if(x){i(x,"error");return}try{g(!0),s==="register"?(await j(d,n,l),i("Регистрация прошла успешно! Вы вошли в систему.","success"),t()):(await b(n,l),t())}catch(o){console.error(o),i(o.response?.data?.message||"Ошибка","error")}finally{g(!1)}};return U.createPortal(e.jsx(N,{children:u&&e.jsxs(m.div,{className:"auth-modal",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[e.jsx(m.div,{className:"auth-modal__overlay",onClick:t,initial:{opacity:0},animate:{opacity:.5},exit:{opacity:0},transition:{duration:.2}}),e.jsxs(m.div,{className:"auth-modal__content",initial:{opacity:0,scale:.8,y:-50},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:-50},transition:{duration:.25,ease:"easeOut"},children:[e.jsx("button",{className:"auth-modal__close",onClick:t,children:"✕"}),e.jsxs("div",{className:"auth-modal__tabs",children:[e.jsx("button",{className:`auth-modal__tab ${s==="login"?"active":""}`,onClick:()=>p("login"),children:"Вход"}),e.jsx("button",{className:`auth-modal__tab ${s==="register"?"active":""}`,onClick:()=>p("register"),children:"Регистрация"})]}),e.jsxs("form",{className:"auth-modal__form",onSubmit:_,children:[s==="register"&&e.jsx("input",{type:"text",placeholder:"Имя пользователя",value:d,onChange:a=>y(a.target.value.replace(/\s/g,"")),required:!0}),e.jsx("input",{type:"email",placeholder:"Email",value:n,onChange:a=>v(a.target.value.replace(/\s/g,"")),required:!0}),e.jsx("input",{type:"password",placeholder:"Пароль",value:l,onChange:a=>f(a.target.value.replace(/\s/g,"")),required:!0}),e.jsx("button",{type:"submit",className:"auth-modal__submit",disabled:h,children:h?e.jsx(S,{size:20}):s==="login"?"Войти":"Зарегистрироваться"})]})]})]})}),document.body)}export{M as A};
