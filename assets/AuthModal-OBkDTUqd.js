import{g as w,d as N,r as o,j as e,A as S,m,L as k}from"./index-DVNBHnrD.js";import{u as A,a as D}from"./default-product-B9eWuczw.js";import{v as L,a as q,b as P}from"./validators-ByLOnyUC.js";var U=N();const C=w(U);function $({onClose:t=()=>{},isOpen:u}){const[s,p]=o.useState("login"),[d,y]=o.useState(""),[n,v]=o.useState(""),[c,f]=o.useState(""),[h,g]=o.useState(!1),{registerUser:j,loginUser:b}=A(),{addToast:r}=D();o.useEffect(()=>{if(!u)return;const a=l=>l.key==="Escape"&&t();return document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[u,t]);const _=async a=>{if(a.preventDefault(),s==="register"){const i=L(d);if(i){r(i,"error");return}}const l=q(n);if(l){r(l,"error");return}const x=P(c);if(x){r(x,"error");return}try{g(!0),s==="register"?(await j(d,n,c),r("Регистрация прошла успешно! Вы вошли в систему.","success"),t()):(await b(n,c),r("Вы вошли в систему!","success"),t())}catch(i){console.error(i);const E=i?.message||i?.response?.data?.message||"Произошла ошибка";r(E,"error")}finally{g(!1)}};return C.createPortal(e.jsx(S,{children:u&&e.jsxs(m.div,{className:"auth-modal",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[e.jsx(m.div,{className:"auth-modal__overlay",onClick:t,initial:{opacity:0},animate:{opacity:.5},exit:{opacity:0},transition:{duration:.2}}),e.jsxs(m.div,{className:"auth-modal__content",initial:{opacity:0,scale:.8,y:-50},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:-50},transition:{duration:.25,ease:"easeOut"},children:[e.jsx("button",{className:"auth-modal__close",onClick:t,children:"✕"}),e.jsxs("div",{className:"auth-modal__tabs",children:[e.jsx("button",{className:`auth-modal__tab ${s==="login"?"active":""}`,onClick:()=>p("login"),children:"Вход"}),e.jsx("button",{className:`auth-modal__tab ${s==="register"?"active":""}`,onClick:()=>p("register"),children:"Регистрация"})]}),e.jsxs("form",{className:"auth-modal__form",onSubmit:_,children:[s==="register"&&e.jsx("input",{type:"text",placeholder:"Имя пользователя",value:d,onChange:a=>y(a.target.value.replace(/\s/g,"")),required:!0}),e.jsx("input",{type:"email",placeholder:"Email",value:n,onChange:a=>v(a.target.value.replace(/\s/g,"")),required:!0}),e.jsx("input",{type:"password",placeholder:"Пароль",value:c,onChange:a=>f(a.target.value.replace(/\s/g,"")),required:!0}),e.jsx("button",{type:"submit",className:"auth-modal__submit",disabled:h,children:h?e.jsx(k,{size:20}):s==="login"?"Войти":"Зарегистрироваться"})]})]})]})}),document.body)}export{$ as A};
