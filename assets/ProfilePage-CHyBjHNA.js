import{j as e,r as c,u as K,L,c as V,m as W,a as Y}from"./index-Btt3JPxB.js";import{u as M,a as T,d as J}from"./default-product-DzEUPTww.js";import{H as $}from"./Header-Chv8LFnO.js";import{A as Z}from"./AuthModal-Bgeonwg8.js";import{P as D,G as R}from"./Pagination-BdLbBim6.js";import{P as G}from"./pica-ChFwJuDz.js";import{v as ee,a as se,b as ae,c as H}from"./validators-ByLOnyUC.js";import{c as te,u as re,b as ie,d as ne}from"./products-iyf2QEbt.js";import{g as ce}from"./orders-Cnz-w333.js";const z="/online-shop-client/assets/default-avatar-XSnGEkHp.png";function le({setIsOpen:s}){const{user:l}=M();return e.jsxs("div",{className:"profile__wrapper",children:[e.jsx("div",{className:"profile__avatar",children:e.jsx("img",{src:l.avatar||z,alt:"avatar",onError:j=>{j.target.src=z}})}),e.jsx("span",{className:"profile__devider"}),e.jsxs("div",{className:"profile__cred",children:[e.jsx("div",{className:"profile__name",children:l.username}),e.jsx("div",{className:"profile__email",children:l.email})]}),e.jsx("button",{className:"profile__settings",onClick:()=>s(!0),children:"‚öôÔ∏è"})]})}function oe({formData:s,setFormData:l,setIsOpen:j}){const{user:o,setUser:f,logoutUser:y}=M(),[p,g]=c.useState(o.avatar||""),[w,b]=c.useState(null),[m,x]=c.useState(!1),[N,C]=c.useState(!1),{addToast:t}=T(),{updateProfile:i,deleteProfile:n,uploadAvatar:r,deleteAvatar:a}=V(),h=K(),u=d=>{l({...s,[d.target.name]:d.target.value.replace(/\s/g,"")})},v=async d=>{d.preventDefault();const S=ee(s.username),U=se(s.email),k=s.password?ae(s.password):null;if(S)return t(S,"error");if(U)return t(U,"error");if(k)return t(k,"error");try{const _=await i(s);f(_),t("–î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã!","success"),j(!1)}catch(_){t(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö: ${_.response?.data?.message}`,"error")}},P=async()=>{C(!0);try{const d=await y();t(`${d.message}`,"success"),h("/")}catch(d){console.error(d),t("–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ","error"),t(d.response?.data?.message,"error")}finally{C(!1)}},O=async()=>{if(window.confirm("–¢—ã —Ç–æ—á–Ω–æ —Ö–æ—á–µ—à—å —É–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç? üò¢"))try{await n(),f(null),t("–ê–∫–∫–∞—É–Ω—Ç –±—ã–ª —É–¥–∞–ª—ë–Ω","success"),h("/")}catch(d){console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏:",d),t("–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∞–∫–∫–∞—É–Ω—Ç–∞","error"),t(d.response?.data?.message,"error")}},E=async d=>{const S=d.target.files[0];if(!S)return;const U=H(S);if(U)return t(U,"error");const k=G(),_=document.createElement("img");_.src=URL.createObjectURL(S),await _.decode();const A=document.createElement("canvas"),q=512,I=Math.min(q/_.width,q/_.height,1);A.width=_.width*I,A.height=_.height*I,await k.resize(_,A);const Q=await k.toBlob(A,S.type),X=new File([Q],S.name,{type:S.type});g(URL.createObjectURL(X)),b(X)},B=async()=>{if(!w)return t("–í—ã–±–µ—Ä–∏—Ç–µ –∞–≤–∞—Ç–∞—Ä","error");x(!0);try{const d=await r(w);f(d),t("–ê–≤–∞—Ç–∞—Ä –æ–±–Ω–æ–≤–ª—ë–Ω!","success"),b(null)}catch(d){console.error(d),t("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∞–≤–∞—Ç–∞—Ä–∞","error")}finally{x(!1)}},F=async()=>{x(!0);try{await a(),f(d=>({...d,avatar:null})),g(""),b(null),t("–ê–≤–∞—Ç–∞—Ä —É–¥–∞–ª—ë–Ω","success")}catch(d){console.error(d),t("–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∞–≤–∞—Ç–∞—Ä–∞","error")}finally{x(!1)}};return e.jsxs("div",{className:"modal__content",children:[e.jsx("h2",{children:"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å"}),e.jsxs("form",{onSubmit:v,className:"product-form",children:[e.jsxs("div",{className:"profile-avatar",children:[e.jsx("img",{src:p||z,alt:"–ê–≤–∞—Ç–∞—Ä",className:"avatar-preview",onError:d=>d.target.src=z}),e.jsx("input",{type:"file",accept:"image/*",onChange:E}),e.jsx("button",{type:"button",className:"btn-black",onClick:B,disabled:m||!w,children:m?e.jsx(L,{size:18}):"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä"}),p&&e.jsx("button",{type:"button",className:"danger",onClick:F,disabled:m,children:m?e.jsx(L,{size:18}):"–£–¥–∞–ª–∏—Ç—å –∞–≤–∞—Ç–∞—Ä"})]}),e.jsx("input",{type:"text",name:"username",value:s.username,onChange:u,placeholder:"–ò–º—è"}),e.jsx("input",{type:"email",name:"email",value:s.email,onChange:u,placeholder:"Email"}),e.jsx("input",{type:"password",name:"password",value:s.password,onChange:u,placeholder:"–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å"}),e.jsx("button",{type:"submit",className:"btn-black",children:"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"})]}),e.jsx("button",{type:"button",className:"logout",onClick:P,disabled:N,children:N?e.jsx(L,{size:18}):"–í—ã–π—Ç–∏"}),e.jsx("button",{onClick:O,className:"danger",children:"–£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç"}),e.jsx("button",{className:"btn-black",onClick:()=>{j(!1),l({username:o.username,email:o.email,password:""})},children:"–ó–∞–∫—Ä—ã—Ç—å"})]})}function de({productData:s,setProductData:l,setIsProductOpen:j,setProducts:o}){const[f,y]=c.useState(!1),[p,g]=c.useState(null),[w,b]=c.useState(null),{addToast:m}=T(),x=t=>{l({...s,[t.target.name]:t.target.value})},N=async t=>{const i=t.target.files[0];if(!i)return;const n=H(i);if(n){m(n,"error");return}try{const r=G(),a=document.createElement("img");a.src=URL.createObjectURL(i),await a.decode();const h=document.createElement("canvas"),u=512,v=Math.min(u/a.width,u/a.height,1);h.width=a.width*v,h.height=a.height*v,await r.resize(a,h);const P=await r.toBlob(h,i.type),O=new File([P],i.name,{type:i.type});g(O),b(URL.createObjectURL(O))}catch(r){console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∂–∞—Ç–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:",r),m("–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫—É","error")}},C=async t=>{if(t.preventDefault(),y(!0),!s.title.trim()){m("–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!","error");return}if(!s.price||isNaN(s.price)||Number(s.price)<=0){m("–¶–µ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —á–∏—Å–ª–æ–º –±–æ–ª—å—à–µ 0!","error");return}if(s.characteristics.find(n=>n.name.trim()===""||n.value.trim()==="")){m("–í—Å–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –∑–Ω–∞—á–µ–Ω–∏–µ!","error");return}try{const n=s.characteristics.reduce((a,h)=>(a[h.name.trim()]=h.value.trim(),a),{}),r=await te({...s,characteristics:n},p);o(a=>[r,...a]),m("–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω!","success"),j(!1),l({title:"",description:"",price:"",tags:"",characteristics:[]}),g(null),b(null)}catch(n){m("–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞!","error"),console.error(n)}finally{y(!1)}};return e.jsxs("div",{className:"modal__content",children:[e.jsx("h2",{children:"–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä"}),e.jsxs("form",{onSubmit:C,className:"product-form",children:[e.jsx("input",{type:"text",name:"title",value:s.title,onChange:x,placeholder:"–ù–∞–∑–≤–∞–Ω–∏–µ",required:!0}),e.jsx("textarea",{name:"description",value:s.description,onChange:x,placeholder:"–û–ø–∏—Å–∞–Ω–∏–µ"}),e.jsx("input",{type:"text",name:"price",value:s.price,onChange:x,placeholder:"–¶–µ–Ω–∞"}),e.jsxs("div",{className:"product-form__image",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:N}),w&&e.jsx("img",{src:w,alt:"–ü—Ä–µ–≤—å—é",className:"product-preview"})]}),e.jsx("input",{type:"text",name:"tags",value:s.tags,onChange:x,placeholder:"–¢–µ–≥–∏ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é"}),e.jsxs("div",{className:"characteristics",children:[e.jsx("h3",{children:"–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏"}),s.characteristics.map((t,i)=>e.jsxs("div",{className:"characteristic-row",children:[e.jsx("input",{type:"text",value:t.name,placeholder:"–ù–∞–∑–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä: —Ü–≤–µ—Ç)",onChange:n=>{const r=[...s.characteristics];r[i].name=n.target.value,l(a=>({...a,characteristics:r}))}}),e.jsx("input",{type:"text",value:t.value,placeholder:"–ó–Ω–∞—á–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä: —á–µ—Ä–Ω—ã–π)",onChange:n=>{const r=[...s.characteristics];r[i].value=n.target.value,l(a=>({...a,characteristics:r}))}})]},i)),e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>l(t=>({...t,characteristics:[...t.characteristics,{name:"",value:""}]})),children:"+ –î–æ–±–∞–≤–∏—Ç—å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É"})]}),e.jsxs("div",{className:"modal__actions",children:[e.jsx("button",{type:"submit",className:"success",disabled:f,children:f?e.jsx(L,{size:40}):"–î–æ–±–∞–≤–∏—Ç—å"}),e.jsx("button",{type:"button",onClick:()=>{j(!1),l({title:"",description:"",price:"",tags:"",characteristics:[]}),g(null),b(null)},children:"–û—Ç–º–µ–Ω–∞"})]})]})]})}function ue({onClose:s}){const l=K(),[j,o]=c.useState([]),[f,y]=c.useState(!0);return c.useEffect(()=>{(async()=>{try{y(!0);const g=await ce();o(g)}catch(g){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤:",g)}finally{y(!1)}})()},[]),f?e.jsx("div",{className:"orders-modal",children:e.jsx(L,{size:120})}):j.length===0?e.jsxs("div",{className:"orders-modal",children:[e.jsx("h3",{children:"–í–∞—à–∏ –∑–∞–∫–∞–∑—ã"}),e.jsx("p",{children:"–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤"}),e.jsx("button",{onClick:s,children:"–ó–∞–∫—Ä—ã—Ç—å"})]}):e.jsxs("div",{className:"orders-modal",children:[e.jsx("h3",{children:"–í–∞—à–∏ –∑–∞–∫–∞–∑—ã"}),e.jsx("ul",{className:"orders-list",children:j.map(p=>e.jsxs("li",{className:"orders-item",onClick:()=>{s(),l(`/cart/success/${p._id}`)},children:[e.jsxs("p",{children:["–ó–∞–∫–∞–∑ ‚Ññ ",p._id.slice(-6)]}),e.jsxs("p",{children:["–°—Ç–∞—Ç—É—Å: ",p.status]}),e.jsxs("p",{children:["–°—É–º–º–∞: ",p.totalPrice," ‚ÇΩ"]})]},p._id))}),e.jsx("button",{onClick:s,children:"–ó–∞–∫—Ä—ã—Ç—å"})]})}function me({product:s,onClose:l,onUpdate:j}){const[o,f]=c.useState({title:s.title,description:s.description,price:s.price,tags:s.tags.join(", "),characteristics:s.characteristics?Object.entries(s.characteristics).map(([r,a])=>({name:r,value:a})):[]}),[y,p]=c.useState(null),[g,w]=c.useState(s.image||null),[b,m]=c.useState(!1),{addToast:x}=T(),N=r=>{f({...o,[r.target.name]:r.target.value})},C=(r,a,h)=>{const u=[...o.characteristics];u[r][a]=h,f(v=>({...v,characteristics:u}))},t=()=>{f(r=>({...r,characteristics:[...r.characteristics,{name:"",value:""}]}))},i=async r=>{const a=r.target.files[0];if(!a)return;const h=H(a);if(h){x(h,"error");return}try{const u=G(),v=document.createElement("img");v.src=URL.createObjectURL(a),await v.decode();const P=document.createElement("canvas"),O=512,E=Math.min(O/v.width,O/v.height,1);P.width=v.width*E,P.height=v.height*E,await u.resize(v,P);const B=await u.toBlob(P,a.type),F=new File([B],a.name,{type:a.type});p(F),w(URL.createObjectURL(F))}catch(u){console.error("–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–∞:",u),x("–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫—É","error")}},n=async r=>{r.preventDefault(),m(!0);try{const a=o.characteristics.filter(u=>u.name.trim()&&u.value.trim()).reduce((u,v)=>(u[v.name.trim()]=v.value.trim(),u),{}),h=await re(s._id,{...o,tags:o.tags.split(",").map(u=>u.trim()).filter(Boolean),characteristics:a},y);j(h),x("–¢–æ–≤–∞—Ä –æ–±–Ω–æ–≤–ª–µ–Ω!","success"),l()}catch(a){x(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞: ${a}`,"error")}finally{m(!1)}};return e.jsxs("div",{className:"edit-product-modal",children:[e.jsx("h2",{children:"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä"}),b?e.jsx("div",{className:"loading-container",children:e.jsx(L,{size:160})}):e.jsxs("form",{onSubmit:n,className:"product-form",children:[e.jsx("input",{name:"title",value:o.title,onChange:N,placeholder:"–ù–∞–∑–≤–∞–Ω–∏–µ",required:!0}),e.jsx("textarea",{name:"description",value:o.description,onChange:N,placeholder:"–û–ø–∏—Å–∞–Ω–∏–µ"}),e.jsx("input",{name:"price",value:o.price,onChange:N,placeholder:"–¶–µ–Ω–∞"}),e.jsxs("div",{className:"product-form__image",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:i}),g&&e.jsx("img",{src:g,alt:"–ü—Ä–µ–≤—å—é",className:"product-preview"})]}),e.jsx("input",{name:"tags",value:o.tags,onChange:N,placeholder:"–¢–µ–≥–∏ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é"}),e.jsxs("div",{className:"characteristics",children:[e.jsx("h3",{children:"–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏"}),o.characteristics.map((r,a)=>e.jsxs("div",{className:"characteristic-row",children:[e.jsx("input",{value:r.name,placeholder:"–ù–∞–∑–≤–∞–Ω–∏–µ",onChange:h=>C(a,"name",h.target.value)}),e.jsx("input",{value:r.value,placeholder:"–ó–Ω–∞—á–µ–Ω–∏–µ",onChange:h=>C(a,"value",h.target.value)})]},a)),e.jsx("button",{type:"button",onClick:t,className:"btn-secondary",children:"+ –î–æ–±–∞–≤–∏—Ç—å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É"})]}),e.jsxs("div",{className:"modal__actions",children:[e.jsx("button",{type:"submit",className:"success",children:"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"}),e.jsx("button",{type:"button",onClick:l,children:"–û—Ç–º–µ–Ω–∞"})]})]})]})}function he({products:s,setProducts:l}){const[j,o]=c.useState(null),[f,y]=c.useState(!0),[p,g]=c.useState(1),[w,b]=c.useState(1),{addToast:m}=T(),{user:x,loading:N}=M();c.useEffect(()=>{if(N)return;(async()=>{y(!0);try{const n=await ie(p,12);l(n.products),b(n.totalPages)}catch(n){console.error(n),m("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è","error")}finally{y(!1)}})()},[x?._id,p,l]);const C=async i=>{if(window.confirm("–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä?"))try{await ne(i),l(n=>n.filter(r=>r._id!==i)),m("–¢–æ–≤–∞—Ä —É–¥–∞–ª—ë–Ω!","success")}catch(n){console.error(n),m("–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞!","error")}},t=i=>{l(s.map(n=>n._id===i._id?i:n))};return e.jsxs("div",{className:"user-products",children:[e.jsx("h2",{children:"–í–ê–®–ò –¢–û–í–ê–†–´"}),f?e.jsx(L,{size:160}):e.jsx("div",{className:"user-products__list",children:s.map((i,n)=>e.jsxs(W.div,{className:"product-card",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{delay:n*.2,duration:.6},children:[e.jsx("img",{className:"catalog__image",src:i.image||J,alt:i.title,onError:r=>{r.target.src=J}}),e.jsx("h3",{children:i.title}),e.jsxs("p",{children:["–¶–µ–Ω–∞: ",i.price]}),e.jsxs("div",{className:"user-products__actions",children:[e.jsx("button",{onClick:()=>o(i),children:"–ò–∑–º–µ–Ω–∏—Ç—å"}),e.jsx("button",{onClick:()=>C(i._id),children:"–£–¥–∞–ª–∏—Ç—å"})]}),e.jsx(Y,{to:`/product/${i._id}`,className:"product-info-circle",children:"!"})]},i._id))}),e.jsx(D,{page:p,setPage:g,totalPages:w}),j&&e.jsx(R,{isOpen:!!j,onClose:()=>o(null),children:e.jsx(me,{product:j,onClose:()=>o(null),onUpdate:t})})]})}function Ne(){const{user:s,loading:l}=M(),[j,o]=c.useState([]),[f,y]=c.useState(!1),[p,g]=c.useState(!1),[w,b]=c.useState(!1),[m,x]=c.useState({username:s?.username||"",email:s?.email||"",password:""}),[N,C]=c.useState({title:"",description:"",price:"",image:"",tags:"",characteristics:[]});c.useEffect(()=>{s&&x({username:s.username||"",email:s.email||"",password:""})},[s]);const t=!s;return l?e.jsxs(e.Fragment,{children:[e.jsx($,{}),e.jsx("div",{className:"container",style:{textAlign:"center",padding:"2rem"},children:e.jsx(L,{size:40})})]}):s?e.jsxs(e.Fragment,{children:[e.jsx($,{}),e.jsxs("section",{className:"profile",children:[e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"profile__container",children:[e.jsx(le,{setIsOpen:g}),e.jsxs("div",{className:"profile__add-product",onClick:()=>b(!0),children:[e.jsx("span",{className:"profile__plus",children:"+"}),e.jsx("p",{children:"–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä"})]}),e.jsx("div",{className:"profile__orders",onClick:()=>y(!0),children:e.jsx("p",{children:"–ü–æ–∫–∞–∑–∞—Ç—å –∑–∞–∫–∞–∑—ã"})})]}),e.jsx("hr",{}),e.jsx(he,{products:j,setProducts:o})]}),p&&e.jsx(R,{isOpen:p,onClose:()=>{g(!1),x({username:s.username,email:s.email,password:""})},children:e.jsx(oe,{formData:m,setFormData:x,setIsOpen:g})}),w&&e.jsx(R,{isOpen:w,onClose:()=>{b(!1),C({title:"",description:"",price:"",image:"",tags:"",characteristics:[]})},children:e.jsx(de,{productData:N,setProductData:C,setIsProductOpen:b,setProducts:o})}),f&&e.jsx(R,{isOpen:f,onClose:()=>y(!1),children:e.jsx(ue,{onClose:()=>y(!1)})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx($,{}),e.jsx("div",{className:"container",children:e.jsx(Z,{isOpen:t})})]})}export{Ne as default};
