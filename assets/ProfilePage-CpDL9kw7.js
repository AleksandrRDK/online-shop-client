import{j as e,r as c,u as J,L,b as Q,c as V}from"./index-DeNsLfE1.js";import{u as M,a as T}from"./default-product-CBJdxHHs.js";import{H as $}from"./Header-CxPdQDku.js";import{A as W}from"./AuthModal-DV-iYBws.js";import{P as Y,a as Z,G as R}from"./Pagination-D1gESSd3.js";import{P as G}from"./pica-CfKZxtzd.js";import{v as D,a as ee,b as se,c as H}from"./validators-ByLOnyUC.js";import{c as te,u as ae,b as re,d as ne}from"./products-B9NjTJRN.js";import{g as ie}from"./orders-0POazPYi.js";const z="/online-shop-client/assets/default-avatar-XSnGEkHp.png";function ce({setIsOpen:s}){const{user:l}=M();return e.jsxs("div",{className:"profile__wrapper",children:[e.jsx("div",{className:"profile__avatar",children:e.jsx("img",{src:l.avatar||z,alt:"avatar",onError:g=>{g.target.src=z}})}),e.jsx("span",{className:"profile__devider"}),e.jsxs("div",{className:"profile__cred",children:[e.jsx("div",{className:"profile__name",children:l.username}),e.jsx("div",{className:"profile__email",children:l.email})]}),e.jsx("button",{className:"profile__settings",onClick:()=>s(!0),children:"‚öôÔ∏è"})]})}function le({formData:s,setFormData:l,setIsOpen:g}){const{user:o,setUser:f,logoutUser:b}=M(),[p,j]=c.useState(o.avatar||""),[w,y]=c.useState(null),[h,x]=c.useState(!1),[N,C]=c.useState(!1),{addToast:a}=T(),{updateProfile:i,deleteProfile:n,uploadAvatar:r,deleteAvatar:t}=Q(),m=J(),u=d=>{l({...s,[d.target.name]:d.target.value.replace(/\s/g,"")})},v=async d=>{d.preventDefault();const S=D(s.username),U=ee(s.email),k=s.password?se(s.password):null;if(S)return a(S,"error");if(U)return a(U,"error");if(k)return a(k,"error");try{const _=await i(s);f(_),a("–î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã!","success"),g(!1)}catch(_){a(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö: ${_.response?.data?.message}`,"error")}},P=async()=>{C(!0);try{const d=await b();a(`${d.message}`,"success"),m("/")}catch(d){console.error(d),a("–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ","error"),a(d.response?.data?.message,"error")}finally{C(!1)}},O=async()=>{if(window.confirm("–¢—ã —Ç–æ—á–Ω–æ —Ö–æ—á–µ—à—å —É–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç? üò¢"))try{await n(),f(null),a("–ê–∫–∫–∞—É–Ω—Ç –±—ã–ª —É–¥–∞–ª—ë–Ω","success"),m("/")}catch(d){console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏:",d),a("–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∞–∫–∫–∞—É–Ω—Ç–∞","error"),a(d.response?.data?.message,"error")}},E=async d=>{const S=d.target.files[0];if(!S)return;const U=H(S);if(U)return a(U,"error");const k=G(),_=document.createElement("img");_.src=URL.createObjectURL(S),await _.decode();const A=document.createElement("canvas"),q=512,I=Math.min(q/_.width,q/_.height,1);A.width=_.width*I,A.height=_.height*I,await k.resize(_,A);const K=await k.toBlob(A,S.type),X=new File([K],S.name,{type:S.type});j(URL.createObjectURL(X)),y(X)},B=async()=>{if(!w)return a("–í—ã–±–µ—Ä–∏—Ç–µ –∞–≤–∞—Ç–∞—Ä","error");x(!0);try{const d=await r(w);f(d),a("–ê–≤–∞—Ç–∞—Ä –æ–±–Ω–æ–≤–ª—ë–Ω!","success"),y(null)}catch(d){console.error(d),a("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∞–≤–∞—Ç–∞—Ä–∞","error")}finally{x(!1)}},F=async()=>{x(!0);try{await t(),f(d=>({...d,avatar:null})),j(""),y(null),a("–ê–≤–∞—Ç–∞—Ä —É–¥–∞–ª—ë–Ω","success")}catch(d){console.error(d),a("–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∞–≤–∞—Ç–∞—Ä–∞","error")}finally{x(!1)}};return e.jsxs("div",{className:"modal__content",children:[e.jsx("h2",{children:"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å"}),e.jsxs("form",{onSubmit:v,className:"product-form",children:[e.jsxs("div",{className:"profile-avatar",children:[e.jsx("img",{src:p||z,alt:"–ê–≤–∞—Ç–∞—Ä",className:"avatar-preview",onError:d=>d.target.src=z}),e.jsx("input",{type:"file",accept:"image/*",onChange:E}),e.jsx("button",{type:"button",className:"btn-black",onClick:B,disabled:h||!w,children:h?e.jsx(L,{size:18}):"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä"}),p&&e.jsx("button",{type:"button",className:"danger",onClick:F,disabled:h,children:h?e.jsx(L,{size:18}):"–£–¥–∞–ª–∏—Ç—å –∞–≤–∞—Ç–∞—Ä"})]}),e.jsx("input",{type:"text",name:"username",value:s.username,onChange:u,placeholder:"–ò–º—è"}),e.jsx("input",{type:"email",name:"email",value:s.email,onChange:u,placeholder:"Email"}),e.jsx("input",{type:"password",name:"password",value:s.password,onChange:u,placeholder:"–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å"}),e.jsx("button",{type:"submit",className:"btn-black",children:"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"})]}),e.jsx("button",{type:"button",className:"logout",onClick:P,disabled:N,children:N?e.jsx(L,{size:18}):"–í—ã–π—Ç–∏"}),e.jsx("button",{onClick:O,className:"danger",children:"–£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç"}),e.jsx("button",{className:"btn-black",onClick:()=>{g(!1),l({username:o.username,email:o.email,password:""})},children:"–ó–∞–∫—Ä—ã—Ç—å"})]})}function oe({productData:s,setProductData:l,setIsProductOpen:g,setProducts:o}){const[f,b]=c.useState(!1),[p,j]=c.useState(null),[w,y]=c.useState(null),{addToast:h}=T(),x=a=>{l({...s,[a.target.name]:a.target.value})},N=async a=>{const i=a.target.files[0];if(!i)return;const n=H(i);if(n){h(n,"error");return}try{const r=G(),t=document.createElement("img");t.src=URL.createObjectURL(i),await t.decode();const m=document.createElement("canvas"),u=512,v=Math.min(u/t.width,u/t.height,1);m.width=t.width*v,m.height=t.height*v,await r.resize(t,m);const P=await r.toBlob(m,i.type),O=new File([P],i.name,{type:i.type});j(O),y(URL.createObjectURL(O))}catch(r){console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∂–∞—Ç–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:",r),h("–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫—É","error")}},C=async a=>{if(a.preventDefault(),b(!0),!s.title.trim()){h("–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!","error");return}if(!s.price||isNaN(s.price)||Number(s.price)<=0){h("–¶–µ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —á–∏—Å–ª–æ–º –±–æ–ª—å—à–µ 0!","error");return}if(s.characteristics.find(n=>n.name.trim()===""||n.value.trim()==="")){h("–í—Å–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –∑–Ω–∞—á–µ–Ω–∏–µ!","error");return}try{const n=s.characteristics.reduce((t,m)=>(t[m.name.trim()]=m.value.trim(),t),{}),r=await te({...s,characteristics:n},p);o(t=>[r,...t]),h("–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω!","success"),g(!1),l({title:"",description:"",price:"",tags:"",characteristics:[]}),j(null),y(null)}catch(n){h("–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞!","error"),console.error(n)}finally{b(!1)}};return e.jsxs("div",{className:"modal__content",children:[e.jsx("h2",{children:"–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä"}),e.jsxs("form",{onSubmit:C,className:"product-form",children:[e.jsx("input",{type:"text",name:"title",value:s.title,onChange:x,placeholder:"–ù–∞–∑–≤–∞–Ω–∏–µ",required:!0}),e.jsx("textarea",{name:"description",value:s.description,onChange:x,placeholder:"–û–ø–∏—Å–∞–Ω–∏–µ"}),e.jsx("input",{type:"text",name:"price",value:s.price,onChange:x,placeholder:"–¶–µ–Ω–∞"}),e.jsxs("div",{className:"product-form__image",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:N}),w&&e.jsx("img",{src:w,alt:"–ü—Ä–µ–≤—å—é",className:"product-preview"})]}),e.jsx("input",{type:"text",name:"tags",value:s.tags,onChange:x,placeholder:"–¢–µ–≥–∏ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é"}),e.jsxs("div",{className:"characteristics",children:[e.jsx("h3",{children:"–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏"}),s.characteristics.map((a,i)=>e.jsxs("div",{className:"characteristic-row",children:[e.jsx("input",{type:"text",value:a.name,placeholder:"–ù–∞–∑–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä: —Ü–≤–µ—Ç)",onChange:n=>{const r=[...s.characteristics];r[i].name=n.target.value,l(t=>({...t,characteristics:r}))}}),e.jsx("input",{type:"text",value:a.value,placeholder:"–ó–Ω–∞—á–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä: —á–µ—Ä–Ω—ã–π)",onChange:n=>{const r=[...s.characteristics];r[i].value=n.target.value,l(t=>({...t,characteristics:r}))}})]},i)),e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>l(a=>({...a,characteristics:[...a.characteristics,{name:"",value:""}]})),children:"+ –î–æ–±–∞–≤–∏—Ç—å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É"})]}),e.jsxs("div",{className:"modal__actions",children:[e.jsx("button",{type:"submit",className:"success",disabled:f,children:f?e.jsx(L,{size:40}):"–î–æ–±–∞–≤–∏—Ç—å"}),e.jsx("button",{type:"button",onClick:()=>{g(!1),l({title:"",description:"",price:"",tags:"",characteristics:[]}),j(null),y(null)},children:"–û—Ç–º–µ–Ω–∞"})]})]})]})}function de({onClose:s}){const l=J(),[g,o]=c.useState([]),[f,b]=c.useState(!0);return c.useEffect(()=>{(async()=>{try{b(!0);const j=await ie();o(j)}catch(j){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤:",j)}finally{b(!1)}})()},[]),f?e.jsx("div",{className:"orders-modal",children:e.jsx(L,{size:120})}):g.length===0?e.jsxs("div",{className:"orders-modal",children:[e.jsx("h3",{children:"–í–∞—à–∏ –∑–∞–∫–∞–∑—ã"}),e.jsx("p",{children:"–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤"}),e.jsx("button",{onClick:s,children:"–ó–∞–∫—Ä—ã—Ç—å"})]}):e.jsxs("div",{className:"orders-modal",children:[e.jsx("h3",{children:"–í–∞—à–∏ –∑–∞–∫–∞–∑—ã"}),e.jsx("ul",{className:"orders-list",children:g.map(p=>e.jsxs("li",{className:"orders-item",onClick:()=>{s(),l(`/cart/success/${p._id}`)},children:[e.jsxs("p",{children:["–ó–∞–∫–∞–∑ ‚Ññ ",p._id.slice(-6)]}),e.jsxs("p",{children:["–°—Ç–∞—Ç—É—Å: ",p.status]}),e.jsxs("p",{children:["–°—É–º–º–∞: ",p.totalPrice," ‚ÇΩ"]})]},p._id))}),e.jsx("button",{onClick:s,children:"–ó–∞–∫—Ä—ã—Ç—å"})]})}function ue({product:s,onClose:l,onUpdate:g}){const[o,f]=c.useState({title:s.title,description:s.description,price:s.price,tags:s.tags.join(", "),characteristics:s.characteristics?Object.entries(s.characteristics).map(([r,t])=>({name:r,value:t})):[]}),[b,p]=c.useState(null),[j,w]=c.useState(s.image||null),[y,h]=c.useState(!1),{addToast:x}=T(),N=r=>{f({...o,[r.target.name]:r.target.value})},C=(r,t,m)=>{const u=[...o.characteristics];u[r][t]=m,f(v=>({...v,characteristics:u}))},a=()=>{f(r=>({...r,characteristics:[...r.characteristics,{name:"",value:""}]}))},i=async r=>{const t=r.target.files[0];if(!t)return;const m=H(t);if(m){x(m,"error");return}try{const u=G(),v=document.createElement("img");v.src=URL.createObjectURL(t),await v.decode();const P=document.createElement("canvas"),O=512,E=Math.min(O/v.width,O/v.height,1);P.width=v.width*E,P.height=v.height*E,await u.resize(v,P);const B=await u.toBlob(P,t.type),F=new File([B],t.name,{type:t.type});p(F),w(URL.createObjectURL(F))}catch(u){console.error("–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–∞:",u),x("–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫—É","error")}},n=async r=>{r.preventDefault(),h(!0);try{const t=o.characteristics.filter(u=>u.name.trim()&&u.value.trim()).reduce((u,v)=>(u[v.name.trim()]=v.value.trim(),u),{}),m=await ae(s._id,{...o,tags:o.tags.split(",").map(u=>u.trim()).filter(Boolean),characteristics:t},b);g(m),x("–¢–æ–≤–∞—Ä –æ–±–Ω–æ–≤–ª–µ–Ω!","success"),l()}catch(t){x(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞: ${t}`,"error")}finally{h(!1)}};return e.jsxs("div",{className:"edit-product-modal",children:[e.jsx("h2",{children:"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä"}),y?e.jsx("div",{className:"loading-container",children:e.jsx(L,{size:160})}):e.jsxs("form",{onSubmit:n,className:"product-form",children:[e.jsx("input",{name:"title",value:o.title,onChange:N,placeholder:"–ù–∞–∑–≤–∞–Ω–∏–µ",required:!0}),e.jsx("textarea",{name:"description",value:o.description,onChange:N,placeholder:"–û–ø–∏—Å–∞–Ω–∏–µ"}),e.jsx("input",{name:"price",value:o.price,onChange:N,placeholder:"–¶–µ–Ω–∞"}),e.jsxs("div",{className:"product-form__image",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:i}),j&&e.jsx("img",{src:j,alt:"–ü—Ä–µ–≤—å—é",className:"product-preview"})]}),e.jsx("input",{name:"tags",value:o.tags,onChange:N,placeholder:"–¢–µ–≥–∏ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é"}),e.jsxs("div",{className:"characteristics",children:[e.jsx("h3",{children:"–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏"}),o.characteristics.map((r,t)=>e.jsxs("div",{className:"characteristic-row",children:[e.jsx("input",{value:r.name,placeholder:"–ù–∞–∑–≤–∞–Ω–∏–µ",onChange:m=>C(t,"name",m.target.value)}),e.jsx("input",{value:r.value,placeholder:"–ó–Ω–∞—á–µ–Ω–∏–µ",onChange:m=>C(t,"value",m.target.value)})]},t)),e.jsx("button",{type:"button",onClick:a,className:"btn-secondary",children:"+ –î–æ–±–∞–≤–∏—Ç—å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É"})]}),e.jsxs("div",{className:"modal__actions",children:[e.jsx("button",{type:"submit",className:"success",children:"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"}),e.jsx("button",{type:"button",onClick:l,children:"–û—Ç–º–µ–Ω–∞"})]})]})]})}function he({products:s,setProducts:l}){const[g,o]=c.useState(null),[f,b]=c.useState(!0),[p,j]=c.useState(1),[w,y]=c.useState(1),{addToast:h}=T(),{user:x,loading:N}=M();c.useEffect(()=>{if(N)return;(async()=>{b(!0);try{const n=await re(p,12);l(n.products),y(n.totalPages)}catch(n){console.error(n),h("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è","error")}finally{b(!1)}})()},[x?.id,p,l]);const C=async i=>{if(window.confirm("–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä?"))try{await ne(i),l(n=>n.filter(r=>r._id!==i)),h("–¢–æ–≤–∞—Ä —É–¥–∞–ª—ë–Ω!","success")}catch(n){console.error(n),h("–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞!","error")}},a=i=>{l(s.map(n=>n._id===i._id?i:n))};return e.jsxs("div",{className:"user-products",children:[e.jsx("h2",{children:"–í–ê–®–ò –¢–û–í–ê–†–´"}),f?e.jsx(L,{size:160}):e.jsx("div",{className:"user-products__list",children:s.map((i,n)=>e.jsxs(Y,{product:i,index:n,children:[e.jsx("h3",{children:i.title}),e.jsxs("p",{children:["–¶–µ–Ω–∞: ",i.price]}),e.jsxs("div",{className:"user-products__actions",children:[e.jsx("button",{onClick:()=>o(i),children:"–ò–∑–º–µ–Ω–∏—Ç—å"}),e.jsx("button",{onClick:()=>C(i._id),children:"–£–¥–∞–ª–∏—Ç—å"})]}),e.jsx(V,{to:`/product/${i._id}`,className:"product-info-circle",children:"!"})]}))}),e.jsx(Z,{page:p,setPage:j,totalPages:w}),g&&e.jsx(R,{isOpen:!!g,onClose:()=>o(null),children:e.jsx(ue,{product:g,onClose:()=>o(null),onUpdate:a})})]})}function we(){const{user:s,loading:l}=M(),[g,o]=c.useState([]),[f,b]=c.useState(!1),[p,j]=c.useState(!1),[w,y]=c.useState(!1),[h,x]=c.useState({username:s?.username||"",email:s?.email||"",password:""}),[N,C]=c.useState({title:"",description:"",price:"",image:"",tags:"",characteristics:[]});c.useEffect(()=>{s&&x({username:s.username||"",email:s.email||"",password:""})},[s]);const a=!s;return l?e.jsxs(e.Fragment,{children:[e.jsx($,{}),e.jsx("div",{className:"container",style:{textAlign:"center",padding:"2rem"},children:e.jsx(L,{size:40})})]}):s?e.jsxs(e.Fragment,{children:[e.jsx($,{}),e.jsxs("section",{className:"profile",children:[e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"profile__container",children:[e.jsx(ce,{setIsOpen:j}),e.jsxs("div",{className:"profile__add-product",onClick:()=>y(!0),children:[e.jsx("span",{className:"profile__plus",children:"+"}),e.jsx("p",{children:"–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä"})]}),e.jsx("div",{className:"profile__orders",onClick:()=>b(!0),children:e.jsx("p",{children:"–ü–æ–∫–∞–∑–∞—Ç—å –∑–∞–∫–∞–∑—ã"})})]}),e.jsx("hr",{}),e.jsx(he,{products:g,setProducts:o})]}),p&&e.jsx(R,{isOpen:p,onClose:()=>{j(!1),x({username:s.username,email:s.email,password:""})},children:e.jsx(le,{formData:h,setFormData:x,setIsOpen:j})}),w&&e.jsx(R,{isOpen:w,onClose:()=>{y(!1),C({title:"",description:"",price:"",image:"",tags:"",characteristics:[]})},children:e.jsx(oe,{productData:N,setProductData:C,setIsProductOpen:y,setProducts:o})}),f&&e.jsx(R,{isOpen:f,onClose:()=>b(!1),children:e.jsx(de,{onClose:()=>b(!1)})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx($,{}),e.jsx("div",{className:"container",children:e.jsx(W,{isOpen:a})})]})}export{we as default};
